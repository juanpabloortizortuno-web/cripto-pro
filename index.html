<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üöÄ CDC FUTURO CRIPTO | PRO ELITE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg-main: #0f1115;
      --bg-card: #1a1d24;
      --accent-yellow: #fcd535;
      --accent-green: #00c853;
      --accent-red: #ff5252;
      --accent-blue: #2196f3;
      --text-light: #e0e0e0;
    }

    body { margin:0; font-family:'Segoe UI',sans-serif; background:var(--bg-main); color:var(--text-light); overflow-x:hidden; }
    header { background: var(--bg-card); padding: 10px; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--accent-yellow); }
    header h1 { margin:0; font-size:16px; color:var(--accent-yellow); }
    header a { color: var(--accent-blue); text-decoration:none; font-size:13px; font-weight:bold; }
    #menuToggle { background: var(--accent-yellow); border:none; border-radius:6px; width:32px; height:32px; font-size:18px; cursor:pointer; }
    #statusBar { text-align:center; padding:8px; background:#1f222a; font-size:13px; border-bottom: 1px solid #333; }
    .container { display:flex; height:calc(100vh - 80px); }
    .sidebar { width:340px; background:var(--bg-card); overflow-y:auto; border-right:2px solid var(--accent-yellow); transition:transform 0.3s ease; z-index:900; }
    .sidebar.hidden { transform:translateX(-100%); position:absolute; }
    input { width:90%; margin:10px; padding:10px; border-radius:6px; border:none; background:#2c2f38; color:white; }
    table { width:100%; border-collapse:collapse; }
    th { background:var(--accent-yellow); color:black; padding:8px; font-size:12px; position:sticky; top:0; }
    td { padding:8px; text-align:center; border-bottom:1px solid #333; font-size:13px; }
    tr:hover { background:#2a2e38; cursor:pointer; }
    .main { flex:1; padding:20px; overflow-y:auto; }
    .card { background:var(--bg-card); padding:20px; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.4); }
    .green { color:var(--accent-green); }
    .red { color:var(--accent-red); }
    .orange { color:orange; }
    .whatsapp-btn { display:block; margin-top:20px; padding:15px; text-align:center; background:#25D366; color:white; font-weight:bold; border-radius:8px; text-decoration:none; }
    .btn-binance { display:block; margin-top:10px; padding:12px; text-align:center; background:var(--accent-blue); color:white; font-weight:bold; border-radius:6px; text-decoration:none; }
    .tiktok-link { display:inline-block; margin-top:15px; padding:10px 15px; background:#FF0050; color:white; border-radius:6px; font-weight:bold; text-decoration:none; text-align:center; }
    .license-input { width:calc(100% - 24px); padding:12px; margin-top:10px; border-radius:6px; border:none; text-align:center; background: #2c2f38; color: white; }
    .license-btn { padding:12px; margin-top:10px; width:100%; background:var(--accent-yellow); border:none; border-radius:6px; font-weight:bold; cursor:pointer; }
    #proStatus { margin-top: 10px; color: var(--accent-green); font-size: 14px; font-weight: bold; display: none; }
  </style>
</head>

<body>

<header>
  <button id="menuToggle">‚¨Ö</button>
  <h1>üöÄ CDC FUTURO CRIPTO ‚Äî PRO ELITE</h1>
  <a class="tiktok-link" href="https://www.tiktok.com/@chicodelascomputadoras" target="_blank">S√≠guenos en TikTok</a>
</header>

<div id="statusBar">Inicializando mercado...</div>
<div id="proStatus"></div>

<div class="container">
  <div class="sidebar" id="sidebar">
    <input id="search" placeholder="üîç Buscar moneda...">
    <table>
      <thead>
        <tr><th>MONEDA</th><th>SUBI√ì 48H</th><th>LE FALTA</th></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <div class="main">
    <div id="details" class="card">Selecciona una moneda.</div>
    
    <a id="linkBinanceWeb" class="btn-binance" target="_blank" style="display:none;">üåê Abrir en Binance Web</a>
    <a id="linkBinanceIOS" class="btn-binance" target="_blank" style="display:none;">üì± iOS</a>
    <a id="linkBinanceAndroid" class="btn-binance" target="_blank" style="display:none;">üì± Android</a>

    <a href="https://wa.me/59177244375" target="_blank" class="whatsapp-btn">üì≤ CONTACTAR POR WHATSAPP</a>

    <div id="licenseArea" style="margin-top: 30px; border-top: 1px solid #444; padding-top: 20px;">
      <input id="premiumCode" placeholder="Pega tu c√≥digo de licencia PRO aqu√≠" class="license-input">
      <button class="license-btn" onclick="activatePremium()">ACTIVAR LICENCIA PERSONALIZADA</button>
      <div id="licenseStatus" style="margin-top:8px; text-align: center; font-weight: bold;"></div>
    </div>
  </div>
</div>

<script>
// =================== L√ìGICA DE LICENCIA PRO ACTUALIZADA ===================
function getDeviceID() {
  let id = localStorage.getItem("deviceID");
  if(!id){
    id = "DEV-"+Math.random().toString(36).substring(2,12).toUpperCase();
    localStorage.setItem("deviceID", id);
  }
  return id;
}

function activatePremium(){
  const code = document.getElementById("premiumCode").value.trim();
  const deviceID = getDeviceID();

  try {
    const decoded = JSON.parse(atob(code));
    const { n: nombre, t: fechaCreacion, d: diasDuracion } = decoded;

    const fechaExpiracion = fechaCreacion + (diasDuracion * 24 * 60 * 60 * 1000);
    if (Date.now() > fechaExpiracion) {
      showLicenseStatus("Esta licencia ha expirado ‚ùå", "red");
      return;
    }

    // Bloqueo de dispositivo: Solo permite esta licencia en el primer dispositivo que la active
    let licenseUsedMap = JSON.parse(localStorage.getItem("licenseUsed") || "{}");
    if(licenseUsedMap[code] && licenseUsedMap[code] !== deviceID) {
        showLicenseStatus("Licencia vinculada a otro equipo ‚ùå", "red");
        return;
    }
    licenseUsedMap[code] = deviceID;
    localStorage.setItem("licenseUsed", JSON.stringify(licenseUsedMap));

    localStorage.setItem("premiumActive","1");
    localStorage.setItem("userName", nombre);
    localStorage.setItem("expirationDate", fechaExpiracion);

    showLicenseStatus(`¬°Bienvenido ${nombre}! Activando... ‚úÖ`, "var(--accent-green)");
    setTimeout(() => location.reload(), 1500);
  } catch (e) {
    showLicenseStatus("C√≥digo inv√°lido o corrupto ‚ùå", "red");
  }
}

function checkSubscription() {
    if (localStorage.getItem("premiumActive") === "1") {
        const exp = parseInt(localStorage.getItem("expirationDate"));
        const nombre = localStorage.getItem("userName");
        
        if (Date.now() > exp) {
            localStorage.removeItem("premiumActive");
            alert("Tu licencia ha expirado. Contacta al administrador.");
            location.reload();
        } else {
            const dias = Math.ceil((exp - Date.now()) / (1000 * 60 * 60 * 24));
            document.getElementById("proStatus").style.display = "block"; 
            document.getElementById("proStatus").innerText = `üü¢ PRO: ${nombre} | ‚è≥ Quedan ${dias} d√≠as`;
            document.getElementById("licenseArea").style.display = "none"; // Ocultar input si ya es pro
            return true;
        }
    }
    return false;
}

function showLicenseStatus(msg,color){ 
  document.getElementById("licenseStatus").innerText = msg; 
  document.getElementById("licenseStatus").style.color=color;
}

// =================== MERCADO Y FUNCIONES ORIGINALES ===================
let premiumActive = checkSubscription();
let clickCount = parseInt(localStorage.getItem("clickCount")||"0");

const sidebar = document.getElementById("sidebar");
document.getElementById("menuToggle").onclick = () => {
  sidebar.classList.toggle("hidden");
  document.getElementById("menuToggle").innerText = sidebar.classList.contains("hidden")?"‚û°":"‚¨Ö";
};

function updateStatus(text){ document.getElementById("statusBar").innerText=text; }

async function getAllUSDTSymbols(){
  try {
    const [spotInfo,futuresInfo] = await Promise.all([
      fetch("https://api.binance.com/api/v3/exchangeInfo").then(r=>r.json()),
      fetch("https://fapi.binance.com/fapi/v1/exchangeInfo").then(r=>r.json())
    ]);
    const spot = spotInfo.symbols.filter(s=>s.status==="TRADING" && s.quoteAsset==="USDT").map(s=>({symbol:s.symbol,type:"spot"}));
    const futures = futuresInfo.symbols.filter(s=>s.status==="TRADING" && s.quoteAsset==="USDT").map(s=>({symbol:s.symbol,type:"futures"}));
    return [...spot,...futures];
  } catch(e) { return []; }
}

async function calculate48h(symbol,type){
  if(!premiumActive && clickCount>=10) return null;
  try {
    const base = type==="futures"?"https://fapi.binance.com/fapi/v1":"https://api.binance.com/api/v3";
    const [klines,ticker] = await Promise.all([
      fetch(`${base}/klines?symbol=${symbol}&interval=1h&limit=48`).then(r=>r.json()),
      fetch(`${base}/ticker/24hr?symbol=${symbol}`).then(r=>r.json())
    ]);
    if(!Array.isArray(klines) || klines.length<48) return null;
    const open48 = parseFloat(klines[0][1]);
    const closeNow = parseFloat(klines[47][4]);
    const change48 = ((closeNow-open48)/open48)*100;
    if(change48<15) return null;
    const high=parseFloat(ticker.highPrice);
    const price=parseFloat(ticker.lastPrice);
    const faltante = ((high-price)/high)*100;
    return {symbol,price,change24:parseFloat(ticker.priceChangePercent),change48,high,low:parseFloat(ticker.lowPrice),volume:parseFloat(ticker.quoteVolume),faltante,type};
  } catch(e){ return null; }
}

async function loadPRO(){
  if(!premiumActive) {
      updateStatus(`Versi√≥n Gratuita: (${clickCount}/10 clics usados)`);
  }
  
  const symbols = await getAllUSDTSymbols();
  const promises = symbols.map(s=>calculate48h(s.symbol,s.type));
  const results = (await Promise.all(promises)).filter(x=>x!==null).sort((a,b)=>b.change48-a.change48);

  if(!premiumActive && clickCount>=10){
    updateStatus("L√≠mite alcanzado. Activa licencia PRO.");
    document.getElementById("tableBody").innerHTML="<tr><td colspan='3'>Licencia requerida üîê</td></tr>";
    return;
  }

  const tableBody=document.getElementById("tableBody");
  tableBody.innerHTML="";
  if(results.length===0){ tableBody.innerHTML="<tr><td colspan='3'>Sin movimientos fuertes</td></tr>"; return; }

  results.forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td><b>${c.symbol.replace("USDT","")}</b></td>
                  <td class="green">${c.change48.toFixed(1)}%</td>
                  <td class="orange">${c.faltante.toFixed(1)}%</td>`;
    tr.onclick=()=>{
        if(!premiumActive) {
            clickCount++;
            localStorage.setItem("clickCount", clickCount);
        }
        showDetails(c);
    };
    tableBody.appendChild(tr);
  });
}

function showDetails(c){
  document.getElementById("details").innerHTML=`
    <h2 style="color:#fcd535">${c.symbol}</h2>
    <p><b>Precio:</b> $${c.price}</p>
    <p class="${c.change24>=0?'green':'red'}"><b>24H:</b> ${c.change24.toFixed(2)}%</p>
    <p class="green"><b>48H:</b> ${c.change48.toFixed(2)}%</p>
    <hr style="border:0; border-top:1px solid #444">
    <p class="orange">Faltante para M√°x 24h: <b>${c.faltante.toFixed(1)}%</b></p>
    <p>Volumen: ${(c.volume/1000000).toFixed(2)}M USDT</p>
  `;
  document.getElementById("linkBinanceWeb").style.display="block";
  document.getElementById("linkBinanceWeb").href=`https://www.binance.com/es/futures/${c.symbol}?type=perpetual`;
  // ... (otros links)
}

loadPRO();
setInterval(loadPRO, 120000); // Actualiza cada 2 min
</script>

</body>
</html>
