<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CDC FUTURO CRIPTO | Dashboard PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f0b90b">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Cripto PRO">

<style>
:root {
  --bg-main: #121212;
  --bg-card: #1e1e28;
  --accent-yellow: #fcd535;
  --accent-blue: #0099ff;
  --accent-green: #4caf50;
  --accent-red: #ff5252;
  --text-light: #e0e0e0;
  --text-muted: #8a8e94;
}

body {
  margin: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-main);
  color: var(--text-light);
  overflow-x: hidden;
}

header {
  background: var(--bg-card);
  padding: 12px;
  border-bottom: 2px solid var(--accent-yellow);
  display: flex;
  justify-content: center;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 1000;
}

header h1 {
  margin: 0;
  color: var(--accent-yellow);
  font-size: 20px;
}

.menu-btn {
  position: absolute;
  left: 12px;
  background: var(--accent-yellow);
  border: none;
  border-radius: 6px;
  width: 35px;
  height: 35px;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

#statusBar {
  text-align: center;
  padding: 8px;
  background: #252531;
  border-bottom: 2px solid var(--accent-blue);
  font-weight: bold;
  font-size: 14px;
}

.container {
  display: flex;
  height: calc(100vh - 110px);
  position: relative;
}

/* SIDEBAR */
.sidebar {
  width: 350px;
  background: var(--bg-card);
  border-right: 2px solid var(--accent-yellow);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease-in-out;
  z-index: 900;
}

.table-container {
  overflow-y: auto;
  flex: 1;
}

/* MAIN CONTENT */
.main {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

input {
  width: calc(100% - 24px);
  margin: 10px 12px;
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #2c2c3a;
  color: var(--text-light);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  position: sticky;
  top: 0;
  background: var(--accent-yellow);
  color: #000;
  padding: 10px;
  font-size: 13px;
  z-index: 10;
}

td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #333;
  font-size: 14px;
}

tr:hover {
  background: #2c2c3a;
  cursor: pointer;
}

/* BOTONES */
.btn-action {
  width: calc(100% - 24px);
  margin: 8px 12px;
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
}

.btn-binance-app {
  background: var(--accent-blue);
  color: #fff;
}

.btn-premium {
  background: var(--accent-yellow);
  color: #000;
}

#details {
  background: #252531;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
  border-left: 4px solid var(--accent-yellow);
}

.section-title {
  padding: 10px 12px;
  font-size: 15px;
  color: var(--accent-blue);
  font-weight: bold;
  background: #1a1a24;
}

footer {
  text-align: center;
  padding: 15px;
  font-size: 13px;
  margin-top: auto;
}

footer a { color: var(--accent-yellow); text-decoration: none; }

.green { color: var(--accent-green); }
.red { color: var(--accent-red); }

/* RESPONSIVE */
@media (max-width: 768px) {
  .sidebar {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 280px;
    box-shadow: 5px 0 15px rgba(0,0,0,0.5);
  }
  .sidebar.hidden {
    transform: translateX(-100%);
  }
  .main {
    width: 100%;
  }
}
</style>
</head>

<body>

<header>
  <button class="menu-btn" id="menuToggle">‚¨Ö</button>
  <h1>üöÄ CDC FUTURO CRIPTO</h1>
</header>

<div id="statusBar">Cargando datos...</div>

<div class="container">

  <div class="sidebar" id="sidebar">
    <input id="search" placeholder="üîç Buscar moneda (ej: BTC)">
    
    <div class="table-container">
      <div class="section-title">üìà FUTURES DISPONIBLES</div>
      <table>
        <thead><tr><th>Moneda</th><th>% M√°x</th><th>Se√±al</th></tr></thead>
        <tbody id="futuresTable"></tbody>
      </table>

      <div class="section-title">‚ú® TOKENS SPOT</div>
      <table>
        <thead><tr><th>Token</th><th>Precio</th></tr></thead>
        <tbody id="spotTable"></tbody>
      </table>
    </div>
    
    <div style="padding: 10px; text-align: center;">
        <a href="https://www.tiktok.com/@chicodelascomputadoras" target="_blank" style="text-decoration:none; color:var(--text-muted); font-size:12px;">
           TikTok: @chicodelascomputadoras
        </a>
    </div>
  </div>

  <div class="main" id="mainContent">

    <div id="details">
      <p style="text-align:center;"><em>Selecciona una moneda para ver el an√°lisis</em></p>
    </div>

    <button id="btnOpenBinance" class="btn-action btn-binance-app">
      üåê Abrir en Binance
    </button>

    <p style="text-align:center;font-size:12px;color:var(--text-muted);margin-top:-5px;">
      *Se intentar√° abrir la App autom√°ticamente.
    </p>

    <div style="margin-top: 20px; border-top: 1px solid #333; padding-top: 20px;">
        <input id="premiumCode" placeholder="üîê Ingresa c√≥digo PREMIUM">
        <button class="btn-action btn-premium" onclick="activatePremium();">Activar Licencia</button>
    </div>

    <footer>
      ¬øSin licencia? <a href="https://wa.me/59177068807" target="_blank">üì≤ WhatsApp +591 77068807</a>
    </footer>

  </div>
</div>

<script>
// CONFIGURACI√ìN Y ESTADO
const menuBtn = document.getElementById("menuToggle");
const sidebar = document.getElementById("sidebar");
const openBtn = document.getElementById("btnOpenBinance");
let currentSymbol = "";
let clickCount = parseInt(localStorage.getItem("clickCount")) || 0;

// TOGGLE SIDEBAR
menuBtn.onclick = () => {
  sidebar.classList.toggle("hidden");
  menuBtn.innerText = sidebar.classList.contains("hidden") ? "‚û°" : "‚¨Ö";
};

// DETECTAR M√ìVIL
const isMobile = () => /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

// ABRIR BINANCE (OPTIMIZADO)
function openBinanceApp(symbol) {
  if (!symbol) return;
  const cleanSymbol = symbol.replace("USDT", ""); // Algunos deep links prefieren el base asset
  
  // Intentamos abrir Futuros directamente
  const appUrl = `binance://futures/${symbol.toUpperCase()}`;
  const webUrl = `https://www.binance.com/es/futures/${symbol.toUpperCase()}`;

  if (isMobile()) {
    const start = Date.now();
    window.location.href = appUrl;
    
    // Si en 1 segundo no cambi√≥ de app, abrir web
    setTimeout(() => {
      if (Date.now() - start < 1500) window.open(webUrl, "_blank");
    }, 1000);
  } else {
    window.open(webUrl, "_blank");
  }
}

openBtn.onclick = () => {
  if (currentSymbol) openBinanceApp(currentSymbol);
  else alert("Selecciona una moneda primero");
};

// L√ìGICA DE PREMIUM
function hasPremium() { return localStorage.getItem("premiumActive") === "1"; }
function updateStatus() {
  const status = document.getElementById("statusBar");
  if (hasPremium()) {
    status.innerText = "‚úÖ LICENCIA PREMIUM ACTIVA";
    status.style.color = "var(--accent-green)";
  } else {
    status.innerText = `‚ú≥Ô∏è Clics gratuitos: ${clickCount} / 10`;
  }
}

function activatePremium() {
  const code = document.getElementById("premiumCode").value.trim();
  if (code.length > 4) {
    localStorage.setItem("premiumActive", "1");
    alert("‚úîÔ∏è ¬°Licencia activada con √©xito!");
    updateStatus();
    location.reload();
  } else {
    alert("C√≥digo inv√°lido");
  }
}

// CARGA DE DATOS (BINANCE API)
async function getFunding(symbol) {
  try {
    const r = await fetch(`https://fapi.binance.com/fapi/v1/premiumIndex?symbol=${symbol}`);
    const j = await r.json();
    return (parseFloat(j.lastFundingRate) * 100).toFixed(4);
  } catch(e) { return "0.0000"; }
}

async function showDetails(c, isSpot = false) {
  if (!hasPremium() && clickCount >= 10) {
    document.getElementById("details").innerHTML = `<p class="red">‚ö†Ô∏è L√≠mite gratuito alcanzado. Contacta a soporte para activar.</p>`;
    return;
  }
  
  if (!hasPremium()) {
    clickCount++;
    localStorage.setItem("clickCount", clickCount);
    updateStatus();
  }

  currentSymbol = c.symbol;
  const funding = isSpot ? "N/A" : await getFunding(c.symbol);

  document.getElementById("details").innerHTML = `
    <h2 style="margin:0; color:var(--accent-yellow);">${c.symbol}</h2>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
      <div><small>Precio:</small><br><strong>${c.price}</strong></div>
      <div><small>Funding:</small><br><strong class="blue">${funding}%</strong></div>
      <div><small>Rango 24h:</small><br><span style="font-size:11px;">${c.low || '-'} / ${c.high || '-'}</span></div>
      <div><small>Cercan√≠a M√°x:</small><br><strong class="${c.distMax < 20 ? 'green':'red'}">${c.distMax ? c.distMax.toFixed(2)+'%' : 'Spot'}</strong></div>
    </div>
  `;
  
  if (window.innerWidth < 768) sidebar.classList.add("hidden");
}

// ... Resto de funciones de carga de datos (loadFuturesList, load, etc) ...
// (Mantenemos tu l√≥gica de fetch que ya funcionaba bien)

const FUTURES_INFO = "https://fapi.binance.com/fapi/v1/exchangeInfo";
const API_24H = "https://api.binance.com/api/v3/ticker/24hr";
let futuresSymbols = new Set();

async function init() {
  try {
    const r = await fetch(FUTURES_INFO);
    const j = await r.json();
    j.symbols.forEach(s => {
      if(s.quoteAsset === "USDT") futuresSymbols.add(s.symbol);
    });
    loadData();
  } catch(e) { console.error("Error inicializando", e); }
}

async function loadData() {
  const r = await fetch(API_24H);
  const data = await r.json();
  const q = document.getElementById("search").value.toUpperCase();

  // Filtrar Futuros
  const fTable = document.getElementById("futuresTable");
  fTable.innerHTML = "";
  data.filter(c => futuresSymbols.has(c.symbol))
    .map(c => {
      const low = +c.lowPrice, high = +c.highPrice, price = +c.lastPrice;
      return { symbol: c.symbol, price, low, high, distMax: ((price-low)/(high-low))*100 };
    })
    .filter(c => c.price >= 0.01 && (!q || c.symbol.includes(q)))
    .sort((a,b) => b.distMax - a.distMax)
    .forEach(c => {
      const tr = document.createElement("tr");
      const signal = c.distMax < 20 ? "üü¢ LONG" : (c.distMax > 80 ? "üî¥ SHORT" : "‚è≥ WAIT");
      tr.innerHTML = `<td>${c.symbol}</td><td>${c.distMax.toFixed(1)}%</td><td class="${c.distMax<20?'green':'red'}">${signal}</td>`;
      tr.onclick = () => showDetails(c);
      fTable.appendChild(tr);
    });

  // Filtrar Spot
  const sTable = document.getElementById("spotTable");
  sTable.innerHTML = "";
  data.filter(c => c.symbol.endsWith("USDT") && !futuresSymbols.has(c.symbol))
    .filter(c => !q || c.symbol.includes(q))
    .slice(0, 20)
    .forEach(c => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${c.symbol}</td><td>${c.lastPrice}</td>`;
      tr.onclick = () => showDetails({symbol: c.symbol, price: c.lastPrice}, true);
      sTable.appendChild(tr);
    });
    
  updateStatus();
}

document.getElementById("search").oninput = loadData;
init();
setInterval(loadData, 30000); // Auto-update cada 30 seg
</script>

</body>
</html>